import { delay } from "./delay";

export async function* streamBotAnswer(userText, attachments = []) {
  const answer = generateBotAnswer(userText, attachments);
  const words = answer.split(" ");

  for (let i = 0; i < words.length; i++) {
    await delay(120);
    yield words.slice(0, i + 1).join(" ");
  }
}

function generateBotAnswer(text, attachments) {
  if (attachments.length > 0) {
    const filesList = attachments.map((f) => `‚Ä¢ ${f.name}`).join("\n");

    return `
–Ø –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

${filesList}

–í–æ—Ç –∫—Ä–∞—Ç–∫–∏–π —Ä–∞–∑–±–æ—Ä:
–§–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å –∞–Ω–∞–ª–∏–∑–æ–º, –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º –∏–ª–∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É.
`.trim();
  }

  if (text.toLowerCase().includes("–∏–Ω—Ç–µ–≥—Ä–∞–ª")) {
    return "–î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä–µ–º –∏–Ω—Ç–µ–≥—Ä–∞–ª—ã –ø–æ —à–∞–≥–∞–º. –°–Ω–∞—á–∞–ª–∞ –≤—Å–ø–æ–º–Ω–∏–º, —á—Ç–æ —Ç–∞–∫–æ–µ –ø–µ—Ä–≤–æ–æ–±—Ä–∞–∑–Ω–∞—è, –∑–∞—Ç–µ–º —Ä–µ—à–∏–º –ø—Ä–∏–º–µ—Ä.";
  }

  if (text.toLowerCase().includes("—Ä—è–¥")) {
    return "–†—è–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π. –ù–∞—á–Ω–µ–º —Å —á–∏—Å–ª–æ–≤—ã—Ö —Ä—è–¥–æ–≤.";
  }

  return `
### üìê –†–µ—à–∏–º –∏–Ω—Ç–µ–≥—Ä–∞–ª

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ:

$$
\\int x^2 \\, dx
$$

–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–æ—Ä–º—É–ª—É:

$$
\\int x^n dx = \\frac{x^{n+1}}{n+1} + C
$$

–ü–æ–¥—Å—Ç–∞–≤–∏–º $n = 2$:

$$
\\int x^2 dx = \\frac{x^3}{3} + C
$$

---

### üß† Inline-—Ñ–æ—Ä–º—É–ª–∞

–¢–µ–æ—Ä–µ–º–∞ –ü–∏—Ñ–∞–≥–æ—Ä–∞: $a^2 + b^2 = c^2$

---

### üßë‚Äçüíª –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

\`\`\`js
function integrate(x) {
  return (x ** 3) / 3;
}
\`\`\`

- [x] –§–æ—Ä–º—É–ª—ã
- [x] Markdown
- [x] –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–æ–¥–∞
- [ ] –ü—Ä–∞–∫—Ç–∏–∫–∞ üòÑ
`.trim();
}